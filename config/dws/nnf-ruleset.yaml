apiVersion: dws.cray.hpe.com/v1alpha1
kind: DWDirectiveRule
metadata:
  name: nnf
  annotations:
    helm.sh/hook: post-install
spec:
  - command: "jobdw"
    watchStates: proposal,setup,pre_run,post_run,teardown
    ruleDefs:
      - key: "type"
        type: "string"
        pattern: "^(raw|xfs|gfs2|lustre)$"
        isRequired: true
        isValueRequired: true
      - key: "capacity"
        type: "string"
        pattern: "^\\d+(KiB|KB|MiB|MB|GiB|GB|TiB|TB)$"
        isRequired: true
        isValueRequired: true
      - key: "name"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: true
        isValueRequired: true
        uniqueWithin: "jobdw_name"
      - key: "profile"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: false
        isValueRequired: true
      - key: "combined_mgtmdt"
        type: "bool"
        isRequired: false
        isValueRequired: false
      - key: "external_mgs"
        type: "string"
        pattern: "^[A-Za-z0-9\\-_\\.@,:]+$"
        isRequired: false
        isValueRequired: true
  - command: "create_persistent"
    watchStates: proposal,setup,teardown
    ruleDefs:
      - key: "type"
        type: "string"
        pattern: "^(raw|xfs|gfs2|lustre)$"
        isRequired: true
        isValueRequired: true
      - key: "capacity"
        type: "string"
        pattern: "^\\d+(KiB|KB|MiB|MB|GiB|GB|TiB|TB)$"
        isRequired: true
        isValueRequired: true
      - key: "name"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: true
        isValueRequired: true
        uniqueWithin: "create_persistent_name"
      - key: "profile"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: false
        isValueRequired: true
      - key: "combined_mgtmdt"
        type: "bool"
        isRequired: false
        isValueRequired: false
      - key: "external_mgs"
        type: "string"
        pattern: "^[A-Za-z0-9\\-_\\.@,:]+$"
        isRequired: false
        isValueRequired: true
  - command: "destroy_persistent"
    watchStates: proposal,teardown
    ruleDefs:
      - key: "name"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: true
        isValueRequired: true
        uniqueWithin: "destroy_persistent_name"
  - command: "persistentdw"
    watchStates: proposal,setup,pre_run,post_run,teardown
    ruleDefs:
      - key: "name"
        type: "string"
        pattern: "^[A-Za-z][A-Za-z0-9-]+$"
        isRequired: true
        isValueRequired: true
  - command: "copy_in"
    watchStates: proposal,data_in,teardown
    ruleDefs:
      - key: "source"
        type: "string"
        isRequired: true
        isValueRequired: true
      - key: "destination"
        type: "string"
        isRequired: true
        isValueRequired: true
  - command: "copy_out"
    watchStates: proposal,data_out,teardown
    ruleDefs:
      - key: "source"
        type: "string"
        isRequired: true
        isValueRequired: true
      - key: "destination"
        type: "string"
        isRequired: true
        isValueRequired: true
